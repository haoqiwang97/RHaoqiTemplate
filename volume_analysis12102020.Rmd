---
title: "volume_analysis12102020"
author: "Haoqi"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
output:
  powerpoint_presentation: default
  beamer_presentation: default
---

```{r include = FALSE}
knitr::opts_chunk$set(echo=FALSE,
                      fig.width=8, fig.height=6,
                      warning=FALSE, message=FALSE,
                      dpi=300)
```

## load data
only keep finished results
```{r}
library(tidyverse)
```
```{r}
file='volume_perception_psycho_December 10, 2020_18.29.csv'
col_names=read_csv(file, n_max = 0) %>% names()

data <- read_csv(file,
                 col_names = col_names,
                 skip = 5)

data <- data %>% filter(Finished==TRUE)
```

```{r}
glimpse(data)
```

## quality control
```{r}
data_good=data %>% filter(age==qual1 & 
                            qual2=="Leaning towards same" & 
                            qual3=="Leaning towards same" & 
                            qual4=="Leaning towards different" &
                            Finished==TRUE)

#data_good=data %>% filter(age==qual1 & 
#                            qual2==0 & 
#                            qual3==1 & 
#                            qual4==1)
n_good=nrow(data_good)
```
```{r}
n_participants=nrow(data)
qualified_ratio=n_good/n_participants
```
Until `r format(Sys.time(), '%d %B, %Y')`, we have `r n_participants` participants **finished** the survey.
We have 4 quality control questions. If we filter with this questions, only `r n_good` left, which is only `r qualified_ratio` of all participants.

Perhaps the quality control questions are too similar to real questions?

## summary
```{r}
# coding
# Prefer not to say <- -1
# Learning towards same <- 0
# Learning towards different <- 1
data <- as.data.frame(data)
for (i in 30:ncol(data)) {
  data[,i][data[,i]=='Prefer not to say']=-1
  data[,i][data[,i]=='Leaning towards same']=0
  data[,i][data[,i]=='Leaning towards different']=1
  data[,i]=as.numeric(data[,i])
}

data <- data %>% mutate(age=as.integer(age),
                        ethnicity=as.factor(ethnicity),
                        race=as.factor(race),
                        gender_1=as.factor(gender_1),
                        gender_2=as.factor(gender_2),
                        sex_orientation=as.factor(sex_orientation),
                        bc_history=as.factor(bc_history),
                        care_pro=as.factor(care_pro))

data_good <- data_good %>% mutate(age=as.integer(age),
                        ethnicity=as.factor(ethnicity),
                        race=as.factor(race),
                        gender_1=as.factor(gender_1),
                        gender_2=as.factor(gender_2),
                        sex_orientation=as.factor(sex_orientation),
                        bc_history=as.factor(bc_history),
                        care_pro=as.factor(care_pro))
```
```{r}
summary(data[,c(6,19:28)])
```
```{r}
summary(data_good[,c(6,19:28)])
```

## duration
```{r}
#ggplot(data=data)+
#  geom_histogram(mapping = aes(x=`Duration (in seconds)`))+
#  ggtitle('Duration')
```

Red are qualified participants

```{r}
ggplot()+
  geom_histogram(mapping = aes(x=`Duration (in seconds)`),data = data,bins=30)+
  geom_histogram(mapping=aes(x=`Duration (in seconds)`),
                 data=data_good,color='red',fill='red',bins=30)#+
  #scale_fill_manual(name='Data quality',values=c("All data","Good data"))
```

## location
About 3 participants are in Hawaii, Alaska, which is not included in the plot.

```{r}
library(ggmap)

states <- map_data('state')
ggplot(states)+
  geom_polygon(mapping = aes(x=long,y=lat,group=group),
               color='grey',fill='beige')+
  coord_map()+
  geom_point(mapping = aes(x=LocationLongitude,y=LocationLatitude),
             data=data %>% filter(LocationLongitude > -130 & LocationLongitude < -60))+
  geom_point(mapping = aes(x=LocationLongitude,y=LocationLatitude),
             data=data_good %>% filter(LocationLongitude > -130 
                                       & LocationLongitude < -60),
             color='red')
```

## age
```{r}
ggplot()+
  geom_histogram(mapping = aes(x=age),data = data)+
  geom_histogram(mapping=aes(x=age),
                 data=data_good,color='red',fill='red')
```

## gender
```{r}
ggplot()+
  geom_bar(data=data,mapping = aes(x=gender_1))+
  scale_x_discrete(guide = guide_axis(n.dodge=6))+
  geom_bar(data=data_good,mapping = aes(x=gender_1),color='red',fill='red')
  #geom_bar(width=1,stat="identity")#+
  #geom_bar(mapping = aes(x=gender_1),stat="identity")#+
  #coord_polar(start=0)
  #+
  #geom_histogram(mapping=aes(x=age),
  #               data=data_good,color='red',fill='red')
```

## race
```{r}
data$race <- data$race %>% substr(0,20)
data_good$race <- data_good$race %>% substr(0,20)
ggplot()+
  geom_bar(data=data,mapping = aes(x=race))+
  scale_x_discrete(guide = guide_axis(n.dodge=2))+
  geom_bar(data=data_good,mapping = aes(x=race),color='red',fill='red')
```

## ethinicity
```{r}
ggplot()+
  geom_bar(data=data,mapping = aes(x=ethnicity))+
  scale_x_discrete(guide = guide_axis(n.dodge=2))+
  geom_bar(data=data_good,mapping = aes(x=ethnicity),color='red',fill='red')
```

## sex orientation
```{r}
ggplot()+
  geom_bar(data=data,mapping = aes(x=sex_orientation))+
  scale_x_discrete(guide = guide_axis(n.dodge=3))+
  geom_bar(data=data_good,mapping = aes(x=sex_orientation),color='red',fill='red')
```

## breast cancer history
```{r}
ggplot()+
  geom_bar(data=data,mapping = aes(x=bc_history))+
  scale_x_discrete(guide = guide_axis(n.dodge=2))+
  geom_bar(data=data_good,mapping = aes(x=bc_history),color='red',fill='red')
```

## health care professional
```{r}
ggplot()+
  geom_bar(data=data,mapping = aes(x=care_pro))+
  scale_x_discrete(guide = guide_axis(n.dodge=2))+
  geom_bar(data=data_good,mapping = aes(x=care_pro),color='red',fill='red')
```

## psychometric
```{r}
# coding
# Prefer not to say <- -1
# Learning towards same <- 0
# Learning towards different <- 1
data <- as.data.frame(data)
for (i in 30:ncol(data)) {
  data[,i][data[,i]=='Prefer not to say']=-1
  data[,i][data[,i]=='Leaning towards same']=0
  data[,i][data[,i]=='Leaning towards different']=1
  data[,i]=as.numeric(data[,i])
}
```
```{r}
# remove data containing -1
row_remove=vector()
for (i in 1:nrow(data)) {
  if (any(-1 %in% data[i,])) {
    #cat(i,'\n')
    row_remove=row_remove %>% append(i)
  }
}
```
```{r}
data_remove=data[-row_remove,35:ncol(data)-5]
glimpse(data_remove)
```
```{r}
count=vector()
ratio=vector()
for (i in 1:ncol(data_remove)) {
  count=count %>% append(sum(data_remove[,i]))
  ratio=ratio %>% append(sum(data_remove[,i])/nrow(data_remove))
  cat(sum(data_remove[,i]),'\n')
}
```
```{r}
data_remove[,i]
```

```{r}
abs_volume_dif=c(
0,
260,
110,
100,
90,
80,
70,
60,
50,
30,
20,
10,
10,
20,
30,
40,
50,
60,
70,
80,
90,
100,
110
)
```

```{r}
plot(ratio~abs_volume_dif
     #,ylim=c(0,1)
     )
```
```{r}
# volume difference = right volume - left volume
volume_dif=c(
0,
260,
110,
100,
90,
80,
70,
60,
50,
30,
20,
10,
-10,
-20,
-30,
-40,
-50,
-60,
-70,
-80,
-90,
-100,
-110
)
```
```{r}
plot(ratio~volume_dif
     #,ylim=c(0,1)
     )
```
